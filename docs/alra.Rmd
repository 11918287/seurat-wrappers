---
title: "Zero-preserving imputation with ALRA"
date: 'Compiled: `r format(Sys.Date(), "%B %d, %Y")`'
output: 
  html_document:
  df_print: kable
theme: united
github_document:
  html_preview: true
toc: true
toc_depth: 3
---
  
This vigettte demonstrates how to run ALRA on Seurat objects, which aims to recover missing values in scRNA-seq data through imputation. If you use ALRA, please cite:
  
**Zero-preserving imputation of scRNA-seq data using low-rank approximation**  
George C. Linderman, Jun Zhao, Yuval Kluger
Manuscript: https://www.biorxiv.org/content/10.1101/397588v1
GitHub: https://github.com/KlugerLab/ALRA


```{r setup, include=FALSE}
knitr::opts_chunk$set(
  tidy = TRUE,
  tidy.opts = list(width.cutoff = 95),
  message = FALSE,
  warning = FALSE
)
```

Prerequisites to install: 
  
* [Seurat](https://satijalab.org/seurat/install) 
* [SeuratWrappers](https://github.com/satijalab/seurat.wrappers)
* [SeuratData](https://github.com/satijalab/seurat-data) 

```{r packages}
library(Seurat)
library(SeuratData)
library(SeuratWrappers)
library(dplyr)
```

### scRNA-seq imputation on pbmc3k

To learn more about this dataset, type `?pbmcsca` 

```{r sctransform, results='hide', cache=TRUE}
InstallData("pbmc3k")
data("pbmc3k")

# Initial processing and visualization
pbmc3k <- SCTransform(pbmc3k) %>% RunPCA() %>% RunUMAP(dims = 1:30)

```
```{r runalra, results='hide', cache=TRUE}
# run ALRA, creates alra assay of imputed values
pbmc3k <- RunALRA(pbmc3k)
```

```{r explore, results='hide', cache=TRUE, out.height = 8, fig.height = 20, fig.width = 16}
# visualize original and imputed values
pbmc3k <- NormalizeData(pbmc3k,assay = 'RNA')
genes_to_plot <- c("CD3D","MS4A1","CD8A","GZMK","NCAM1","FCGR3A")

DefaultAssay(pbmc3k) <- 'RNA'
plot1 <- FeaturePlot(pbmc3k,genes_to_plot,ncol = 2)

DefaultAssay(pbmc3k) <- 'alra'
plot2 <- FeaturePlot(pbmc3k,genes_to_plot,ncol = 2,cols = c('lightgrey','red'))

CombinePlots(list(plot1,plot2),ncol = 1)

```
